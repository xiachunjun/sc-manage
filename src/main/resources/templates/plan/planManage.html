<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta charset="utf-8" />
<title menu-code="00000004">计划管理</title>

<meta name="description" content="overview &amp; stats" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<#include "/common/parts/common-css.html"/>

</head>
<body class="no-skin">
	<#include "/common/parts/header.html"/>
	<div class="main-container ace-save-state" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.loadState('main-container')
			} catch (e) {}
		</script>

		<#include "/common/parts/asider.html"/>
		<div class="main-content">
			<div class="main-content-inner">
				<div class="breadcrumbs ace-save-state">
					<div class="row">
						<div class="col-sm-12" style="font-size: 13px;padding-left: 20px;">
							<div class="col-sm-6 pull-left">
								<span>当前位置</span> > <span>责任晒板</span> > <span>计划完成情况</span>
							</div>
							<div class="col-sm-6 text-right" style="padding-right: 20px;">
								<button class="btn btn-white radius-4" onclick="window.location.href='/plan/addPlan'">新建</button>
								<button class="btn btn-white radius-4" onclick="window.location.href='/page/plan/planList'">返回</button>
							</div>
						</div>
					</div>
				</div>
				<div class="page-content">
					<div class="row">
						<div class="col-xs-12">
							<div class="row">
								<div class="space-6"></div>
								<div class="col-sm-12">
									<div class="row">
										<div class="">
											<div class="widget-box transparent">
												<div class="widget-header">
													<div class="widget-toolbar no-border" style="float: left;">
														<ul class="nav nav-tabs" id="recent-tab">
															<li class="active"><a data-toggle="tab" href="#task-tab">待办计划</a></li>
															<li><a data-toggle="tab" href="#member-tab">在办计划</a></li>
															<li><a data-toggle="tab" href="#comment-tab">我的计划</a></li>
														</ul>
													</div>
												</div>
												<div class="widget-body">
													<div class="widget-main padding-4">
														<div class="tab-content padding-8">
															<div id="task-tab" class="tab-pane active">
																<div class="row">
																	<div class="col-xs-12">
																		<div class="row">
																			<div class="space-6"></div>
																			<div class="col-sm-12 center">
																				<div class="space-6"></div>
																				<form id="queryForm1" class="form-horizontal" role="form"
																					onsubmit="return false;">
																					<input type="hidden" name="tab" value="1" />
																					<div class="form-group">
																						<label class="col-sm-1 control-label no-padding-right" for="refDeptId">部门</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="refDeptId1" name="refDeptId">
																								<option value="${userInfo.deptId!''}">${userInfo.deptName!''}</option>
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="refUserId">责任人</label>
																						<div class="col-sm-1">
																							<select style="width: 100%;" id="refUser1" name="refUserId">
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="rateOfProgress">进度节点</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="rateOfProgress1" name="rateOfProgress">
																								<option value=""></option>
																								<option value="2">部门领导确认</option>
																								<option value="3">责任人执行</option>
																								<option value="4">部门领导审批</option>
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="planDate">计划年月</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="planDate1" name="planDate">

																							</select>
																						</div>

																						<div class="col-sm-1 align-left">
																							<button class="btn btn-white radius-4" style="padding: 4px 12px;"
																								onclick="load(1)">查询</button>
																						</div>
																					</div>
																				</form>
																			</div>
																		</div>
																		<div class="row">
																			<div class="space-6"></div>
																			<div class="col-sm-12 center">
																				<table id="tfhover" class="tftable" border="1">
																					<tr>
																						<th>序号</th>
																						<th>月份</th>
																						<th>部门</th>
																						<th>岗位</th>
																						<th>责任人</th>
																						<th>进度状态</th>
																						<th>进度节点</th>
																						<th>申请时间</th>
																					</tr>
																					<tbody id="tableBody1"></tbody>
																				</table>
																			</div>
																		</div>

																	</div>
																</div>
															</div>

															<div id="member-tab" class="tab-pane">
																<div class="clearfix">
																	<div class="row">
																		<div class="col-xs-12">
																			<div class="row">
																				<div class="space-6"></div>
																				<div class="col-sm-12 center">
																					<div class="space-6"></div>
																					<form id="queryForm2" class="form-horizontal" role="form"
																						onsubmit="return false;">
																						<input type="hidden" name="tab" value="2" />
																						<div class="form-group">
																							<label class="col-sm-1 control-label no-padding-right" for="refDeptId">部门</label>
																							<div class="col-sm-2">
																								<select style="width: 100%;" id="refDeptId2" name="refDeptId">
																									<option value="${userInfo.deptId!''}">${userInfo.deptName!''}</option>
																								</select>
																							</div>
																							<label class="col-sm-1 control-label no-padding-right" for="refUserId">责任人</label>
																							<div class="col-sm-1">
																								<select style="width: 100%;" id="refUser2" name="refUserId">
																								</select>
																							</div>
																							<label class="col-sm-1 control-label no-padding-right" for="rateOfProgress">进度节点</label>
																							<div class="col-sm-2">
																								<select style="width: 100%;" id="rateOfProgress2" name="rateOfProgress">
																									<option value=""></option>
																									<option value="2">部门领导确认</option>
																									<option value="3">责任人执行</option>
																									<option value="4">部门领导审批</option>
																								</select>
																							</div>
																							<label class="col-sm-1 control-label no-padding-right" for="planDate">计划年月</label>
																							<div class="col-sm-2">
																								<select style="width: 100%;" id="planDate2" name="planDate">
																								</select>
																							</div>

																							<div class="col-sm-1 align-left">
																								<button class="btn btn-white radius-4" style="padding: 4px 12px;"
																									onclick="load(2)">查询</button>
																							</div>
																						</div>
																					</form>
																				</div>
																			</div>
																			<div class="row">
																				<div class="space-6"></div>
																				<div class="col-sm-12 center">
																					<table id="tfhover" class="tftable" border="1">
																						<tr>
																							<th>序号</th>
																							<th>月份</th>
																							<th>部门</th>
																							<th>岗位</th>
																							<th>责任人</th>
																							<th>进度状态</th>
																							<th>进度节点</th>
																							<th>审批时间</th>
																						</tr>
																						<tbody id="tableBody2"></tbody>
																					</table>
																				</div>
																			</div>

																		</div>
																	</div>
																</div>
															</div>

															<div id="comment-tab" class="tab-pane">
																<div class="row">
																	<div class="col-xs-12">
																		<div class="row">
																			<div class="space-6"></div>
																			<div class="col-sm-12 center">
																				<div class="space-6"></div>
																				<form id="queryForm3" class="form-horizontal" role="form"
																					onsubmit="return false;">
																					<input type="hidden" name="tab" value="3" />
																					<div class="form-group">
																						<label class="col-sm-1 control-label no-padding-right" for="refDeptId">部门</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="refDeptId3" name="refDeptId">
																								<option value="${userInfo.deptId!''}">${userInfo.deptName!''}</option>
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="refUserId">责任人</label>
																						<div class="col-sm-1">
																							<select style="width: 100%;" id="refUser3" name="refUserId">
																								<option value="${userInfo.userId!''}">${userInfo.userName!''}</option>
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="rateOfProgress">进度节点</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="rateOfProgress3" name="rateOfProgress">
																								<option value=""></option>
																								<option value="2">部门领导确认</option>
																								<option value="3">责任人执行</option>
																								<option value="4">部门领导审批</option>
																							</select>
																						</div>
																						<label class="col-sm-1 control-label no-padding-right" for="planDate">计划年月</label>
																						<div class="col-sm-2">
																							<select style="width: 100%;" id="planDate3" name="planDate">
																							</select>
																						</div>

																						<div class="col-sm-1 align-left">
																							<button class="btn btn-white radius-4" style="padding: 4px 12px;"
																								onclick="load(3)">查询</button>
																						</div>
																					</div>
																				</form>
																			</div>
																		</div>
																		<div class="row">
																			<div class="space-6"></div>
																			<div class="col-sm-12 center">
																				<table id="tfhover" class="tftable" border="1">
																					<tr>
																						<th>序号</th>
																						<th>月份</th>
																						<th>部门</th>
																						<th>岗位</th>
																						<th>责任人</th>
																						<th>进度状态</th>
																						<th>进度节点</th>
																						<th>完成时间</th>
																					</tr>
																					<tbody id="tableBody3"></tbody>
																				</table>
																			</div>
																		</div>

																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<#include "/common/parts/footer.html"/>
	</div>
	<#include "/common/parts/common-js.html"/>
	<#include "/common/parts/submit-form-js.html"/>

	<script src="/static/assets/js/ace-elements.min.js"></script>
	<script src="/static/assets/js/sc-date.js"></script>
	<script type="text/javascript">
		jQuery(function($) {
			function showErrorAlert(reason, detail) {
				var msg = '';
				if (reason === 'unsupported-file-type') {
					msg = "Unsupported format " + detail;
				} else {
					console.log("error uploading file", reason, detail);
				}
			}
			renderPlanDateList();
			renderUser();
			renderDept();
			load(1);
		});
		function renderPlanDateList() {
			var planDateList = dateList({
				'format' : 'yyyy年MM月'
			});
			var ht = "";
			for (var i = 0; i < planDateList.length; i++) {
				ht = ht + "<option value='" + planDateList[i].key + "'>" + planDateList[i].value + "</option>"
			}
			$("#planDate1").html(ht);
			$("#planDate2").html(ht);
			$("#planDate3").html(ht);
		}
	
		var load = function(tab) {
			var formId = 'queryForm1';
			if (1 == tab) {
				formId = 'queryForm1';
			} else if (2 == tab) {
				formId = 'queryForm2';
			} else if (3 == tab) {
				formId = 'queryForm3';
			}
			submitForm({
				'formId' : formId,
				'url' : '/plan/queryByTab',
				'catchError' : true,
				'callBack' : dataListRender
			});
		}
	
		function dataListRender(rsp) {
			var ht = "";
			var planList = rsp.dataMap.planList;
			if (planList && planList.length > 0) {
				var indexNo = 1;
				for (var i = 0; i < planList.length; i++) {
					var plan = planList[i];
					ht = ht + "<tr class='center'><td>" + (indexNo++) + "</td>";
					ht = ht + "<td>" + formatDate2(plan.planDate, true) + "</td>";
					ht = ht + "<td>" + plan.deptName + "</td>";
					ht = ht + "<td>" + plan.posiName + "</td>";
					ht = ht + "<td>" + plan.userName + "</td>";
					ht = ht + "<td>" + plan.rateOfProgressName + "</td>";
					ht = ht + "<td>" + plan.progressInfo + "</td>";
					ht = ht + "<td>" + "审核时间" + "</td>";
				}
			} else {
				ht = ht + "<tr><td colspan='8'>未查到相关记录</td></tr>";
			}
			$("#tableBody1").html("");
			$("#tableBody1").append(ht);
			$("#tableBody2").html("");
			$("#tableBody2").append(ht);
			$("#tableBody3").html("");
			$("#tableBody3").append(ht);
		}
	
		function renderUser() {
			$.ajax({
				type : 'POST',
				url : '/user/query/list',
				data : JSON.stringify({}),
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					if (resultCode == '000000' & dataMap != null) {
						var ht = "<option value=''></option>";
						var userList = dataMap.userList;
						if (userList && userList.length > 0) {
							for (i = 0; i < userList.length; i++) {
								ht = ht + "<option value='" + userList[i].id + "'>" + userList[i].userName + "</option>";
							}
							$("#refUser1").html(ht);
							$("#refUser2").html(ht);
							//$("#refUser3").html(ht);
						}
					} else {
						alert("获取信息异常-" + JSON.stringify(data));
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		}
		
		function renderDept() {
			$.ajax({
				type : 'POST',
				url : '/dept/queryDeptList',
				data : JSON.stringify({}),
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					if (resultCode == '000000' & dataMap != null) {
						var ht = "<option value=''></option>";
						var deptList = dataMap.depts;
						if (deptList && deptList.length > 0) {
							for (i = 0; i < deptList.length; i++) {
								ht = ht + "<option value='" + deptList[i].id + "'>" + deptList[i].deptName + "</option>";
							}
							$("#refDeptId1").html(ht);
							$("#refDeptId2").html(ht);
							//$("#refDeptId3").html(ht);
						}
					} else {
						alert("获取信息异常-" + JSON.stringify(data));
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		}
	</script>
</body>
</html>
