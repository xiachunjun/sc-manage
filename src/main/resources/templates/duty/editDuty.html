<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta charset="utf-8" />
<title menu-code="00000002">责任清单-编辑</title>

<meta name="description" content="overview &amp; stats" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

<#include "/common/parts/common-css.html"/>

<link rel="stylesheet" href="assets/css/bootstrap-datepicker3.min.css" />
</head>
<body class="no-skin">
	<#include "/common/parts/header.html"/>
	<div class="main-container ace-save-state" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.loadState('main-container')
			} catch (e) {}
		</script>
		<#include "/common/parts/asider.html"/>

		<div class="main-content">
			<div class="main-content-inner">
				<div class="breadcrumbs ace-save-state">
					<div class="row">
						<div class="col-sm-12" style="font-size: 13px;padding-left: 20px;">
							<div class="col-sm-6 pull-left">
								<span>当前位置</span> > <span>责任晒板</span> > <span>责任清单</span>
							</div>
							<div class="col-sm-6 text-right" style="padding-right: 20px;">
								<button class="btn btn-white radius-4" onclick="window.location.href='/duty/dutyList';">返回</button>
							</div>
						</div>
					</div>
				</div>
				<div class="page-content">
					<div class="row">
						<div class="col-xs-12">
							<div class="row">
								<div class="space-6"></div>
								<div class="col-sm-12">
									<div class="col-sm-offset-4" style="font-size: 18px; font-weight: bold;">责任清单-编辑</div>
									<div class="space-6"></div>
									<form id="editDutyForm" class="form-horizontal" role="form" onsubmit="return false;">
										<div class="form-group">
											<label class="col-sm-3 control-label no-padding-right" for="departmentCode">部门</label>
											<div class="col-sm-9">
												<select class="col-xs-10 col-sm-5" id="departmentCode" name="departmentCode">

												</select>
											</div>
										</div>
										<div class="form-group">
											<label class="col-sm-3 control-label no-padding-right" for="positionCode">岗位</label>
											<div class="col-sm-9">
												<select class="col-xs-10 col-sm-5" id="positionCode" name="positionCode">

												</select>
											</div>
										</div>
										<div class="form-group">
											<label class="col-sm-3 control-label no-padding-right" for="userCode">责任人</label>
											<div class="col-sm-9">
												<select class="col-xs-10 col-sm-5" id="userCode" name="userCode">

												</select>
											</div>
										</div>
										<div class="form-group">
											<div class="col-sm-offset-4">
												<button id="saveBtn" class="btn btn-primary radius-4">保存</button>
												<button class="btn btn-primary radius-4">重置</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<#include "/common/parts/footer.html"/>
	</div>
	<#include "/common/parts/common-js.html"/>
	<script src="/static/assets/js/jquery.form.js"></script>
	<script src="/static/assets/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/assets/js/ace-elements.min.js"></script>
	<script src="/static/assets/js/jquery.serializejson.min.js"></script>
	<script type="text/javascript">
	 	jQuery(function($) {
	 		$('#departmentCode').on('change', function(e) {
	 			renderPosition();
	 		});
	 	});
	 	
		function renderDept() {
			$.ajax({
				type : 'POST',
				url : '/department/queryAll',
				data : null,
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					if (resultCode == '000000' & dataMap != null) {
						var ht = "";
						var depts = dataMap.depts;
						if (depts && depts.length > 0) {
							for (i = 0; i < depts.length; i++) {
								ht = ht + "<option value='" + depts[i].departmentCode + "'>" + depts[i].departmentName + "</option>";
							}
							$("#departmentCode").html(ht);
						}
						renderPosition();
					} else {
						alert("获取部门列表失败！");
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		}
	
		function renderPosition(deptCode) {
			var da = {};
			if (!deptCode) {
				deptCode = $("#departmentCode").val();
			}
			da.departmentCode = deptCode;
			$.ajax({
				type : 'POST',
				url : '/position/queryByDeptCode',
				data : JSON.stringify(da),
				headers : {
					"Content-Type" : "application/json"
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					var ht = "";
					if (resultCode == '000000' & dataMap != null) {
						var positions = dataMap.positions;
						if (positions && positions.length > 0) {
							for (i = 0; i < positions.length; i++) {
								ht = ht + "<option value='" + positions[i].positionCode + "'>" + positions[i].positionName + "</option>";
							}
						}
						$("#positionCode").html(ht);
					} else {
						alert("获取信息异常-" + JSON.stringify(data));
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		}
	
		function renderUser() {
			$.ajax({
				type : 'POST',
				url : '/user/query/list',
				data :  JSON.stringify({}),
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					if (resultCode == '000000' & dataMap != null) {
						var ht = "";
						var userList = dataMap.userList;
						if (userList && userList.length > 0) {
							for (i = 0; i < userList.length; i++) {
								ht = ht + "<option value='" + userList[i].userCode + "'>" + userList[i].userLoginName + "</option>";
							}
							$("#userCode").html(ht);
						}
					} else {
						alert("获取信息异常-" + JSON.stringify(data));
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		}
	
		$("#saveBtn").on("click", function() {
			if (!window.confirm('确认提交？')) {
				return;
			}
			var paramJson = $('#editDutyForm').serializeJSON();
			$.ajax({
				type : 'POST',
				url : '/position/editPosition',
				data : JSON.stringify(paramJson),
				headers : {
					'Content-Type' : 'application/json'
				},
				success : function(data) {
					var resultCode = data.resultCode;
					var dataMap = data.dataMap;
					if (resultCode == '000000') {
						alert("保存成功");
					} else {
						alert("保存失败");
					}
				},
				dataType : 'json',
				error : function(data) {
					alert("获取信息异常-" + JSON.stringify(data));
				}
			});
		});
	
		renderDept();
		renderUser();
	</script>
</body>
</html>
